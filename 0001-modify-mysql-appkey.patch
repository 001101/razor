From aa8eb396a9da230b93fec4f596f1b0ed11de884a Mon Sep 17 00:00:00 2001
From: "qinghai.zhang" <qinghai.zhang@wbkit.com>
Date: Tue, 16 Feb 2016 16:41:27 +0800
Subject: [PATCH] modify mysql appkey

---
 web/application/models/api/common.php      | 11 +++++++++++
 web/application/models/service/utility.php |  1 +
 2 files changed, 12 insertions(+)

diff --git a/web/application/models/api/common.php b/web/application/models/api/common.php
index 0ee8d66..7c11814 100644
--- a/web/application/models/api/common.php
+++ b/web/application/models/api/common.php
@@ -97,6 +97,17 @@ class Common extends CI_Model
                             return $ret;
                 }
             }
+            //appkey
+            if($array[$i] == "appkey") {
+                preg_match("/[^A-Za-z0-9]/", $content->$array[$i],$pregs);
+                if(isset($pregs) && count($pregs)) {
+                     $ret = array(
+                                    'flag' => - 8,
+                                    'msg' => $array[$i] . ' is invalid'
+                            );
+                            return $ret;
+                }
+            }
         }
         $ret = array(
                 'flag' => 1,
diff --git a/web/application/models/service/utility.php b/web/application/models/service/utility.php
index faddaf1..67995e9 100644
--- a/web/application/models/service/utility.php
+++ b/web/application/models/service/utility.php
@@ -48,6 +48,7 @@ class Utility extends CI_Model
      */
     function isKeyAvailale($key)
     {
+        $key = addslashes($key);
         $query = $this->db->query("select * from " . $this->db->dbprefix('channel_product') . " where productkey = '$key'");
         if ($query != null && $query->num_rows() > 0) {
             return true;
-- 
1.8.3.msysgit.0

